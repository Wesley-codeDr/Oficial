# test-pdf-export - Kanban Tasks

Generated from tasks.md

## Tasks

### To Do

- [ ] T1: @react-pdf/renderer installed (v3.1.14+)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T2: react-pdf installed (v7.5.1+)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T3: No TypeScript errors after installation
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T4: pnpm typecheck passes
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T5: All directories created
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T6: Index.ts files exist in component directories
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T7: No duplicate directories
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T8: vercel.json created/updated
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T9: PDF export route configured with 1024 MB memory
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T10: PDF export route configured with 10s timeout
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T11: ExportPdfRequestSchema defined
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T12: Validates sessionId as cuid string
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T13: TypeScript types exported
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T14: Schema exported for API route use
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T15: Component renders without errors
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T16: All CFM-required fields present (date, professional, findings)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T17: Portuguese language used throughout
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T18: Red flags displayed prominently when present
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T19: Footer includes WellWave branding
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T20: Multi-page support (if content overflows)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T21: Styles properly defined (Helvetica font, readable sizes)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T22: Endpoint responds to POST requests
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T23: Request validation works (400 on invalid)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T24: Authentication enforced (401 on unauthorized)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T25: Authorization enforced (403 on wrong user)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T26: Returns 404 for non-existent session
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T27: Returns 200 with PDF binary for valid request
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T28: Content-Type header set to application/pdf
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T29: Content-Disposition header set with correct filename
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T30: Filename format: anamnesis-[syndrome]-[date].pdf
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T31: Errors logged to Sentry
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T32: Response time <3 seconds (tested)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T33: All test cases implemented
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T34: Tests pass (pnpm vitest run)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T35: Coverage >80% for API route
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T36: Mocks properly isolated
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T37: No test pollution between cases
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T38: Hook uses useMutation
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T39: Calls correct API endpoint
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T40: Sends correct request body (sessionId)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T41: Downloads PDF blob to browser
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T42: Extracts filename from Content-Disposition header
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T43: Throws error on failure with message
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T44: TypeScript types properly defined
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T45: Component accepts sessionId, syndrome, disabled props
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T46: Renders Button with FileDown icon
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T47: Shows loading state (spinner + "Gerando PDF...")
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T48: Shows idle state ("Exportar PDF" + icon)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T49: Calls useExportPdf on click
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T50: Disabled when isPending or disabled prop
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T51: ARIA label present
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T52: Keyboard accessible (Enter key)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T53: Responsive design (works on mobile)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T54: All test cases implemented
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T55: Tests pass (pnpm vitest run)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T56: Coverage >80% for component
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T57: Mocks properly isolated
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T58: Accessibility tested
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T59: Button visible on anamnesis results page
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T60: Button placed in logical location
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T61: Button disabled when no anamnesis generated
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T62: Button enabled after anamnesis generated
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T63: Proper styling with Tailwind
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T64: Responsive on mobile/tablet/desktop
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T65: Success toast shown on successful export
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T66: Error toast shown on failed export
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T67: Error messages user-friendly (Portuguese)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T68: All error types handled
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T69: Toast auto-dismisses after 5 seconds
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T70: Button remains clickable after error
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T71: All error scenarios tested
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T72: Toast notifications called correctly
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T73: Error messages in Portuguese
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T74: Tests pass (pnpm vitest run)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T75: PDF template verified to contain no patient identifiers
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T76: "DOCUMENTO ANÃ”NIMO" label present
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T77: Only anonymous session data in PDF
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T78: No fields for patient name, CPF, ID, etc.
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T79: Security tests implemented
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T80: 401 tested for no token
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T81: 401 tested for invalid token
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T82: 403 tested for wrong user
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T83: Tests pass (pnpm vitest run)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T84: Complete user flow tested
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T85: Download event captured
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T86: Filename matches pattern: anamnesis-[syndrome]-[date].pdf
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T87: File contains valid PDF header (%PDF)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T88: Test passes locally (pnpm playwright test)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T89: Test passes in CI
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T90: Unauthorized access tested
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T91: 403 status code verified
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T92: Error message verified
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T93: No download triggered
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T94: Test passes
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T95: Loading state tested
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T96: "Gerando PDF..." text visible
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T97: Spinner animation visible
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T98: Loading state removed after completion
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T99: Normal state restored
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T100: Test passes
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T101: All unit tests pass (pnpm vitest run)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T102: All E2E tests pass (pnpm playwright test)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T103: No TypeScript errors (pnpm typecheck)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T104: No lint errors (pnpm lint)
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T105: Test coverage >80%
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T106: No test pollution
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T107: JSDoc comments on all public APIs
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T108: Parameters documented
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T109: Return types documented
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T110: Usage examples included
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T111: No undocumented exports
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T112: CHANGELOG.md updated
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T113: Version entry added
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T114: Feature documented
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T115: Changes listed
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T116: **Batch Export**: Allow exporting multiple anamneses at once
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T117: **PDF Caching**: Cache generated PDFs to avoid regeneration
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T118: **Custom Templates**: Allow users to customize PDF layout
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T119: **Digital Signature**: Add digital signature support
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T120: **Email Delivery**: Send PDF via email instead of download
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T121: **Print Preview**: Show preview before download
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T122: **Export Formats**: Support Word, HTML, etc.
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T123: **Audit Logging**: Add PdfExport table to database
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T124: **Rate Limiting**: Add rate limiting per user
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T125: **Performance Metrics**: Track PDF generation time
  - Labels: spec:test-pdf-export, phase:Unknown

- [ ] T138: Human review received (recommended)
  - Labels: spec:test-pdf-export, phase:Unknown

### Done

- [x] T126: `specs/test-pdf-export/tasks.md` created and complete

- [x] T127: All tasks have clear descriptions

- [x] T128: All tasks have file paths listed

- [x] T129: All tasks have step-by-step instructions

- [x] T130: Dependencies identified for each task

- [x] T131: Parallel-safe tasks marked with ``

- [x] T132: Acceptance criteria defined per task

- [x] T133: Execution order documented

- [x] T134: Time estimates provided

- [x] T135: Risk assessment complete

- [x] T136: Dependency graph created

- [x] T137: Parallel execution opportunities identified

- [x] T139: Context budget: Still in Smart Zone (20-40%)
